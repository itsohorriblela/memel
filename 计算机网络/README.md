# 浏览器发起一次HTTPS请求的过程详解

HTTPS会对HTTP的URL和Request Body都进行加密

## 构建请求

## 查找浏览器缓存

## DNS解析

1. 查询浏览器DNS缓存

2. 查询操作系统DNS缓存

3. 读取hosts文件

4. 请求DNS服务器

## TCP三次握手

## TLS四次握手

### 客户端发送client Hello ,消息包含TLS版本以及client random随机字符串

### 服务端发送server Hello, 消息包含数字证书以及server random随机字符串，证书通过CA私钥加密。

### 客户端验证证书，通过CA公钥解密。（CA公钥不多，一般直接配置到操作系统或浏览器里。）

1. 检查数字签名

2. 验证证书链

3. 检查证书有效期

4. 检查证书的撤回状态

### 客户端发送 pre_master secret字符串，利用服务端证书里的公钥加密 （加密算法如RSA)

### 服务端利用服务端私钥解密获得pre_master secret

### 客户端和服务端利用client random 、server random、 pre_master secret 生成共享密钥

### 客户端就绪，发送共享密钥加密过的finished

### 服务端就绪， 发送共享密钥加密过的finished

## 达成安全通信，通过共享密钥加密传输数据

## 四次挥手


# 非对称加密与对称加密啊  

因为非对称加密慢，对称加密相对来说快一些。

# 为什么要用三个随机数？ 直接用pre_master secret不行吗？

确实，就算没有另外两个，也并不影响加密功能。之所以还要两个随机数，是因为只有单个 pre_master_key随机性不足，多次随机的情况下有可能出来的秘钥是一样的。但如果再引入两个随机数，就能大大增加"会话秘钥"的随机程度，从而保证每次HTTPS通信用的会话秘钥都是不同的。




# 网站带WWW和不带有什么区别

	本质上两者的域名是不同的，建议将没有www的域名重定向的www的域名。统一有助于将权重集中在一个域名上。


# sse 与 web socket

## sse (server-sent events)  


SSE 是基于 HTTP 的服务器推送技术，使用简单的长轮询机制。  
客户端通过在浏览器中创建 EventSource 对象来与服务器建立 SSE 连接。  
服务器可以实时地将事件流数据推送到客户端，客户端通过监听事件进行处理。  
SSE 适用于单向的服务器到客户端的推送，服务器可以持续地向客户端发送事件流数据。  
SSE 只能使用 HTTP 协议，不能使用其他协议。


## web scoket

WebSocket 是一种全双工的通信协议，通过在客户端和服务器之间建立持久连接实现双向通信。   
客户端通过在浏览器中创建 WebSocket 对象来与服务器建立 WebSocket 连接。  
WebSocket 连接使用 WebSocket 协议，不依赖于 HTTP，可以使用其他协议（如 ws:// 或 wss://）。  
WebSocket 提供了一种双向通信的机制，客户端和服务器可以随时发送消息给对方。  
WebSocket 适用于需要实时双向通信的应用，如聊天应用、协作编辑、实时数据更新等。    

## 对比

SSE 适用于服务器向客户端单向推送事件流的场景，通常用于实时的通知、实时更新等应用。  
WebSocket 适用于双向通信的场景，允许客户端和服务器之间进行实时的双向数据交换，通常用于实时聊天、实时协作等应用。  
SSE 使用基于 HTTP 的长轮询机制，而 WebSocket 使用独立的协议。  
SSE 对于支持的浏览器比较广泛，但功能较为有限；WebSocket 需要更高级的浏览器支持，但提供了更丰富的功能。  
根据应用需求，可以选择 SSE 或 WebSocket 来实现实时通信，具体取决于通信模式和功能要求。
    

## IP地址分类  

	A类： 1.0.0.0 ～ 127.255.255.255 
	B类： 128.0.0.0 ～ 191.255.255.255  
	C类： 192.0.0.0 ～ 223.255.255.255  
	D类： 224.0.0.0 ～ 239.255.255.255  特殊用途  
	E类： 240.0.0.0 ～ 255.255.255.255  暂时保留  

### 私有地址

在IPv4地址中预留了3个IP地址段，作为私有地址，共家庭、企业、学校等内部组网使用。  
10.0.0.0 ～ 10.255.255.255  
172.16.0.0 ～ 172.31.255.255  
192.168.0.0 ～ 192.168.255.255  
在局域网里的多个设备通过公网ip访问互联网时，可以通过NAT地址转换，像作者说的地址转换表。通过这张地址转换表，路由器会将你的内网ip连同端口号一起转换为外网ip和端口号，这样就可以访问你要通信的主机，来达到通信目的。  


# NAT

NAT设备，全称Network Address Translation，网络地址转换。  

NAT负责将内网IP-PORT与公网IP-PORT做一个映射转换。

# 内网穿透 

没有什么是加中间层不能解决的，如果有，那就再加一层

因为NAT的存在，我们只能从内网主动发起连接，否则NAT设备不会记录相应的映射关系，没有映射关系也就不能转发数据。
所以我们就在公网上加一台服务器x，并暴露一个访问域名，再让内网的服务主动连接服务器x，这样NAT路由器上就有对应的映射关系。接着，所有人都去访问服务器x，服务器x将数据转发给内网机器，再原路返回响应，这样数据就都通了。这就是所谓的内网穿透。

# NAT打洞

通过一个中间server在双方的NAT上留下映射关系，来打通连接。

linux内核中唯一标识一个网络连接是通过五元组  （传输协议，源IP，目的IP，源端口，目的端口）


# 用了CDN一定比不用CDN快吗？   

用了CDN时，未命中CDN缓存导致回源，就会比不用的时候更慢。

解决方法： 刷新预热

CDN最大的优势在于，对于来自世界各地的用户，它可以就近分配CDN节点获取数据，并且多次重复获取同一个文件数据的时候，有缓存加速的作用。如果你的服务和对象存储都在内网，并且文件数据也不太会有重复使用的可能性，那其实没必要接入cdn。


# 世界上只有13组DNS服务器，如果国外卡我们脖子咋办 ？

虽然根域只有13个IP，但不代表只有13台服务器，准确的说，应该是十三组服务器，每组服务器都共用同一个IP，国内已经有非常多的镜像服务器，利用任播技术，只要能就近访问到其中一台就行了。
我们只要镜像一份国外的DNS域名服务器信息到国内机房里。我们就不再需要请求国外服务器了。


# 电脑如何获得自己的IP？

DHCP（Dynamic Host Configuration Protocol，动态主机配置协议）
向某个管IP分配的服务器，也就是DHCP服务器，申请IP地址。

拿到IP后会发三条无偿ARP， 会把IP和mac地址都填好告诉本地网段的所有机器，也可以检查IP是否冲突。








