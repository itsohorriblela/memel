# 有用的SQL命令

## CONCAT
在 MySQL 中，CONCAT 函数用于将多个字符串连接在一起。它接受两个或多个参数，并返回这些参数连接后的字符串。
SELECT CONCAT('My name is ', first_name, ' ', last_name) AS full_name FROM users;  

## EXPLAIN
EXPLAIN 是 MySQL 数据库提供的一个关键字，用于分析和优化查询语句的执行计划。通过 EXPLAIN，您可以获取有关查询的详细信息，了解 MySQL 在执行查询时所采取的操作和优化策略。

要使用 EXPLAIN，只需在查询语句前加上 EXPLAIN 关键字，然后执行该语句。MySQL 将返回一个描述查询执行计划的结果集，其中包含以下重要的列：

id: 表示查询中每个操作的标识符，主要用于连接操作。  
select_type: 描述查询的类型，例如简单查询、联接查询、子查询等。  
table: 指示查询涉及的表。  
type: 表示每个表的访问方式，例如全表扫描、索引扫描、范围扫描等。  
possible_keys: 表示可能用于查询的索引。  
key: 表示实际选择的索引。  
key_len: 表示索引使用的字节数。  
ref: 表示索引的比较列。  
rows: 表示查询扫描的行数估计值。  
Extra: 提供其他与查询相关的附加信息，如排序操作、临时表使用等。  



# 坑 

## 大小写

MySQL在Linux下数据库名、表名、列名、别名大小写规则是这样的：
1、数据库名与表名是严格区分大小写的；  
2、表的别名是严格区分大小写的；  
3、列名与列的别名在所有的情况下均是忽略大小写的；  
4、字段内容默认情况下是大小写不敏感的。  

InnoDB在创建表时可以设置 COLLATE utf8mb4_bin指定大小写敏感  
`show collation where charset = 'utf8mb4';`
ci结尾为大小写不敏感，bin结尾的是大小写敏感  



# 基础知识 

## InnoDB在RR级别下如何解决幻读

在RR的隔离级别下，Innodb使用MVCC和next-key locks解决幻读，MVCC解决的是普通读（快照读）的幻读，next-key locks解决的是当前读情况下的幻读。 

### 当前读

所谓当前读，指的是加锁的select(S或者X), update, delete等语句。在RR的事务隔离级别下，数据库会使用next-key locks来锁住本条记录以及索引区间。 

### 普通读

因为普通读是不会加锁的读，故不会有next-key locks的使用，解决幻读的手段是MVCC  

MVCC会给每行元组加一些辅助字段，记录创建版本号和删除版本号。

而每一个事务在启动的时候，都有一个唯一的递增的版本号。每开启一个新事务，事务的版本号就会递增。 

默认的隔离级别（REPEATABLE READ）下，增删查改变成了这样：  

- SELECT

读取创建版本小于或等于当前事务版本号，并且删除版本为空或大于当前事务版本号的记录。这样可以保证在读取之前记录是存在的  

- INSERT

将当前事务的版本号保存至行的创建版本号  

- UPDATE

新插入一行，并以当前事务的版本号作为新行的创建版本号，同时将原记录行的删除版本号设置为当前事务版本号  

- DELETE

将当前事务的版本号保存至行的删除版本号  



## 最左前缀原则

	左前缀原则指的是，如果查询的时候查询条件精确匹配索引的左边连续一列或几列，则此列就可以被用到  
	查询的时候如果两个条件都用上了，但是顺序不同，如 city= xx and name ＝xx，那么现在的查询引擎会自动优化为匹配联合索引的顺序，这样是能够命中索引的。  
	由于最左前缀原则，在创建联合索引时，索引字段的顺序需要考虑字段值去重之后的个数，较多的放前面。ORDER BY子句也遵循此规则。  

    原理： 构建一颗B+树只能根据一个值来构建，因此数据库依据联合索引最左的字段来构建B+树。  


## char、varchar、text的选择
1. char长度固定，char(n)中的n表示字符数，最大长度是255个字符, 即每条数据占用等长字节空间；适合用在身份证号码、手机号码等定。

2. varchar可变长度，varchar(n)中的n表示字符数，最大空间是65535个字节, 可以设置最大长度；适合用在长度可变的属性。

3. text不设置长度， 当不知道属性的最大长度时，适合用text。







